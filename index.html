<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Trema本</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{font-weight: normal}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#00}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Trema本</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_openflowの仕組み">OpenFlowの仕組み</a>
<ul class="sectlevel2">
<li><a href="#_ソフトウェアで思いどおりにコントロール">ソフトウェアで思いどおりにコントロール</a></li>
<li><a href="#_sdn_ネットワークをソフトウェアで制御しよう">SDN: ネットワークをソフトウェアで制御しよう</a></li>
<li><a href="#_openflowの仕組み_2">OpenFlowの仕組み</a></li>
<li><a href="#_openflowのうれしさ">OpenFlowのうれしさ</a></li>
<li><a href="#_openflowで気をつけること">OpenFlowで気をつけること</a></li>
<li><a href="#_まとめ">まとめ</a></li>
</ul>
</li>
<li><a href="#_hello_trema">Hello, Trema!</a>
<ul class="sectlevel2">
<li><a href="#_作ってわかるopenflow">作ってわかるOpenFlow</a></li>
<li><a href="#_tremaとは">Tremaとは</a></li>
<li><a href="#_trema実行環境のセットアップ">Trema実行環境のセットアップ</a></li>
<li><a href="#_hello_trema_2">Hello, Trema!</a></li>
<li><a href="#_trema_コマンド">trema コマンド</a></li>
<li><a href="#_即席ruby入門">即席Ruby入門</a></li>
<li><a href="#_まとめ_2">まとめ</a></li>
<li><a href="#_参考文献">参考文献</a></li>
</ul>
</li>
<li><a href="#_copyright_and_license">Appendix A: Copyright and License</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_openflowの仕組み">OpenFlowの仕組み</h2>
<div class="sectionbody">
<div class="paragraph">
<p>近ごろ話題のOpenFlowって、どんな仕組みで何がうれしいのでしょうか? 難しいネットワーク用語を使わずに、身近な話で解説します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/how_does_openflow_work/incredible_machine.png" alt="incredible machine">
</div>
</div>
<div class="sect2">
<h3 id="_ソフトウェアで思いどおりにコントロール">ソフトウェアで思いどおりにコントロール</h3>
<div class="quoteblock">
<blockquote>
無精 (Laziness): エネルギーの総支出を減らすために、多大な努力をするように、あなたをかりたてる性質。こうして労力を省くために書いたプログラムは他人も使うようになり、そのプログラムに関する質問にいちいち答えずに済ますためにドキュメントを書くようになる。それゆえ、プログラマにとって最も重要な素質である。またそれゆえ、この本が存在するのである。
</blockquote>
<div class="attribution">
&#8212; Larry Wall<br>
<cite>『プログラミングPerl』(オーム社)</cite>
</div>
</div>
<div class="paragraph">
<p>優れたプログラマが持つハッカー気質の1つに「無精」があります。大好きなコンピュータの前から一時も離れずに、どうやってジャンクフードを手に入れるか……普通の人からするとただの横着に見えるかもしれませんが、ハッカー達にとってそれはいつでも大きな問題でした。</p>
</div>
<div class="paragraph">
<p>ソフトウェアによる横着はハッカーが最も創造性を発揮する分野の一つです。時間のかかる仕事も、うまく技術を駆使すれば自動化してさっと終わらせることができるのです。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ハッカーの巣窟として有名なMITのAIラボにはかつて、コンピュータからオンラインでピザを注文できるUNIXコマンドが存在しました<span class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</span>。ハックしていて腹が減ったらコマンドをたたいてピザを取る、なんとも横着です。</p>
</li>
<li>
<p>コンピュータサイエンスの名門、カーネギーメロン大学にはコーク・マシンという変わったコーラ自販機がかつてあり、UNIXコマンド一発でコーラの冷え具合を確認できるようになっていました<span class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</span>。遠くの自販機まで行って<strong>ぬるい</strong>コーラをつかまされないための工夫です。</p>
</li>
<li>
<p>RFC (Request For Comment) で標準化されているコーヒーポットプロトコルでは、遠隔地にあるコーヒーポットのコーヒーの量を監視したり、コーヒーを自動的にいれたりするための半分冗談のインターフェースを定義しています<span class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</span>。本当に実装してしまった人もいたそうですから驚きです。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>こうした「ソフトウェアで楽をする」ハックのうち、もっとも大規模な例が最新鋭のデータセンターです。クラウドサービスの裏で動くデータセンターは極めて少人数のエンジニアが運用しており、大部分の管理作業をソフトウェアによって極限まで自動化している、という記事を呼んだことのある人も多いでしょう。このようにピザやコーラ、コーヒーのようなお遊びから、データセンターのように一筋縄ではいかない相手まで、ソフトウェアで「モノ」を思いどおりにコントロールするのは何よりも楽しく、そして実際に役立つハックの一種です。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>こうした最新鋭データセンターでのネットワーク管理自動化の仕組みは第15章および第16章で解説します。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_sdn_ネットワークをソフトウェアで制御しよう">SDN: ネットワークをソフトウェアで制御しよう</h3>
<div class="paragraph">
<p>その中でもネットワークをハックする技術の1つが、本書で取り上げるOpenFlowです。簡単に言えば、OpenFlowとはネットワークスイッチの動作を制御するための標準プロトコルの1つです。OpenFlowを使えばスイッチ1つひとつの動作をソフトウェアから自由に書き換えられるので、究極的にはネットワーク全体の動作をソースコードとして記述できます。これをSoftware Defined Networking(SDN、ソフトウェアで定義されるネットワーク)と呼び、OpenFlowはSDNを実現する代表的な技術として注目を集めています。</p>
</div>
<div class="paragraph">
<p>OpenFlowの登場によって、これからはネットワークもプログラミングの対象になります。「いまだに手で管理してるの?そんなのソフトウェアで自動化しようぜ!」ハッカー達のこんな声が聞こえてきそうです。たしかに、今までネットワーク管理と言えば専門のオペレータ達による手作業がメインでした。横着できる部分はたくさんあるはずです。</p>
</div>
<div class="paragraph">
<p>ハッカーに負けない創造性とOpenFlowのプログラマブルな特性が組み合わされば、次のような「究極の自動化」も夢ではなくなります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>障害やトラフィック情報など、あらゆる情報を収集し集中管理できるネットワーク</p>
</li>
<li>
<p>ユーザやアプリケーションの追加・削除に応じて、自動的に構成を変更するネットワーク</p>
</li>
<li>
<p>追加投資をしなくても、既存のインフラを目一杯まで使ってスケールするネットワーク</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>本書はこれらすべてのトピックを扱います。自宅や職場のような中小規模ネットワークからデータセンターのような超大規模ネットワークまで、具体的なOpenFlowの適用例を見ながら「OpenFlowってどんなもので、具体的に何に使えるのだろう?」という素朴な疑問に答えます。また「さっそくOpenFlowを使ってすごいネットークを作ってみたい!」というプログラマ向けには、実際に動かせる実用的なコードをたくさん載せました。</p>
</div>
<div class="paragraph">
<p>本書を読み進めるにあたって、ネットワークやプログラミングの深い知識は不要です。基本から1つひとつ説明しますので、ネットワークの専門家はもちろん、プログラマやシステムエンジニア、そして営業職や管理職などなどOpenFlowに興味を持つ方であれば誰でもすんなり理解できるように構成してあります。ではさっそく、OpenFlowの仕組みを理解しましょう。</p>
</div>
</div>
<div class="sect2">
<h3 id="_openflowの仕組み_2">OpenFlowの仕組み</h3>
<div class="paragraph">
<p>OpenFlowの仕組みを理解するために、ちょっとした<strong>たとえ話</strong>から始めましょう。みなさんもきっと利用したことがあると思いますが、よくあるカスタマーサポートを思い浮かべてください。そう、テレビとかパソコンの調子が悪くなったときに、フリーダイヤルで相談するアレです。それって、どこがOpenFlowと関係あるのでしょう?</p>
</div>
<div class="paragraph">
<p>実はOpenFlowの基本的な仕組みはカスタマーサポートにとてもよく似ているのです。これからお話しするストーリーが分かれば、OpenFlowの95%を理解できたも同然です。それではさっそく、このストーリーの主人公の友太郎(ゆうたろう)君と、カスタマーサポートセンターで働く青井さん、そして上司の宮坂主任の3人に登場してもらいましょう。</p>
</div>
<div class="sect3">
<h4 id="_エアコンが壊れた">エアコンが壊れた</h4>
<div class="paragraph">
<p>今年もエアコンの活躍する季節がやってきました。ところが友太郎君のエアコンはどうにも調子がよくありません。そこで取扱説明書に載っていたカスタマーサポートに電話することにしました。自動音声に従って問題ありそうな項目をすべてチェックしてみましたが、いっこうに解決しません。結局、自動音声はあきらめて電話サポートに相談することになりました。</p>
</div>
<div class="paragraph">
<p>「はい、こちらカスタマーサポートセンターです。担当はわたくし青井がうけたまわります。ご要件は何でしょうか?」</p>
</div>
<div class="paragraph">
<p>青井さんはヨーヨーダイン・エアコン社で働く電話オペレータです。お客さんから不具合の症状を聞き出し, 症状の内容に応じてそれぞれの担当サポートに電話をつなぎます(<a href="#yoyodyne_support">図1-1</a>)。</p>
</div>
<div id="yoyodyne_support" class="imageblock">
<div class="content">
<img src="images/how_does_openflow_work/yoyodyne_support.png" alt="yoyodyne support">
</div>
<div class="title">図1-1電話サポートはお客さんからの問い合わせを適切な担当サポートへ転送</div>
</div>
<div class="paragraph">
<p>「なんだかリモコンの調子が悪いんです。温度表示がずっと点滅してるんですけど、どうしたら直りますか?」</p>
</div>
<div class="paragraph">
<p>青井さんは手元の対応マニュアルを開きます (<a href="#operator_manual">表1-1</a>)。対応マニュアルには問い合わせ内容と、それを直せる担当サポートが載っています。続く数字はそれぞれの問い合わせ件数です。</p>
</div>
<table id="operator_manual" class="tableblock frame-all grid-all spread">
<caption class="title">表1-1 電話サポート用対応マニュアル</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">問い合わせ内容</th>
<th class="tableblock halign-left valign-top">対応方法</th>
<th class="tableblock halign-left valign-top">問い合わせ件数</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リモコンの不調</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周辺機器担当サポートに転送</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">エアコン本体の不調</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エアコン担当サポートに転送</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6 件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">室外機の不調</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周辺機器担当サポートに転送</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">いたずら電話</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">電話を切る</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 件</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ちょうどマニュアルの先頭に探していた項目がみつかりました。</p>
</div>
<div class="paragraph">
<p>「ご不便をおかけしました。担当のサポートにただいまおつなぎいたします」</p>
</div>
<div class="paragraph">
<p>電話の転送を終えると、青井さんはリモコン不調の問い合わせ件数を8件から9件にアップデートしました(<a href="#operator_manual_update">表1-2</a>)。</p>
</div>
<table id="operator_manual_update" class="tableblock frame-all grid-all spread">
<caption class="title">表1-2 問い合わせ件数をアップデートする</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">問い合わせ内容</th>
<th class="tableblock halign-left valign-top">対応方法</th>
<th class="tableblock halign-left valign-top">問い合わせ件数</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リモコンの不調</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周辺機器担当サポートに転送</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>9 件</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">エアコン本体の不調</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エアコン担当サポートに転送</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6 件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">室外機の不調</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周辺機器担当サポートに転送</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">いたずら電話</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">電話を切る</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 件</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>こうすることでどんな問い合わせが多いかを社内にフィードバックできます。たとえばリモコンに関する問い合わせが多ければ、開発部署は次の製品開発にこの情報を生かしリモコンの改良をできますし、サポート部署は周辺機器担当のサポートメンバーを増やすという判断ができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_これをopenflowに置き換えると">これをOpenFlowに置き換えると…</h4>
<div class="paragraph">
<p>OpenFlowの世界では、パケットを送信するホストがお客さんの友太郎君、パケットを転送するOpenFlowスイッチが電話オペレータの青井さんに対応します(<a href="#openflow_host_switch">図1-2</a>)。ホストがパケットを送ると、OpenFlowスイッチはパケットの中身に応じてパケットを適切に処理します。これはちょうど、青井さんが友太郎君からの問い合わせ内容に応じて適切な担当サポートに電話を転送するのと同じです。</p>
</div>
<div id="openflow_host_switch" class="imageblock">
<div class="content">
<img src="images/how_does_openflow_work/openflow_host_switch.png" alt="openflow host switch">
</div>
<div class="title">図1-2OpenFlowではホストがお客さん、スイッチが電話サポートセンター、そしてフローテーブルがマニュアルに対応</div>
</div>
<div class="paragraph">
<p>OpenFlowスイッチは、その動作が「マニュアル化」されています。カスタマーサポートの例では、青井さんはマニュアルから対応方法を調べました。OpenFlowスイッチは、パケットの処理方法をスイッチ内のフローテーブルと呼ぶデータベースを参照して決めます。青井さんの業務がすべマニュアル化されているのと同じく、OpenFlowスイッチの動作はすべてこのフローテーブルの中身によって決まります。</p>
</div>
</div>
<div class="sect3">
<h4 id="_パケット処理内容を管理するフローテーブル">パケット処理内容を管理するフローテーブル</h4>
<div class="paragraph">
<p>フローテーブルには、「こういうパケットが届いたら、こう処理する」というルールがいくつか記録されています。このルールをフローエントリと呼びます。フローエントリはちょうど「リモコンの故障に関する問い合わせが来たら、リモコン担当サポートに電話を転送する」といったマニュアルの各項目に対応します。</p>
</div>
<div class="paragraph">
<p>実際のフローテーブルの例を見てみましょう。<a href="#flow_table_entry">表1-3</a>はあるスイッチのフローテーブルで、各行が1つひとつのフローエントリに対応します。フローエントリは主にマッチフィールド、インストラクション、そしてカウンタの3つの要素から成ります。</p>
</div>
<table id="flow_table_entry" class="tableblock frame-all grid-all spread">
<caption class="title">表1-3 フローテーブルとフローエントリの例</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">マッチフィールド</th>
<th class="tableblock halign-left valign-top">インストラクション</th>
<th class="tableblock halign-left valign-top">カウンタ</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信元IPアドレス = 192.168.1.00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポート8番に転送</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80パケット</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VLAN ID = 10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポート10番に転送</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64パケット</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信元MACアドレス = 00:50:56:c0:00:08</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VLAN ID = 2 を付けてポート8番に転送</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24パケット</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信元IPアドレス = 27.55.0.0/16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パケットを破棄</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 パケット</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>マッチフィールド: マッチフィールドは届いたパケットに対応するフローエントリを探すための「条件」として使われます。たとえば「リモコンの調子がおかしい」という問い合わせから対応方法を決めたように、パケットの特徴に合うマッチフィールドから処理方法、つまりインストラクションを決めます。</p>
</li>
<li>
<p>インストラクション: インストラクションは届いたパケットをどう処理するかという「処理方法」にあたります。たとえば「リモコン担当サポートへ引き継ぎ」と同じく、インストラクションには「スイッチのポート8番に転送」などと指定します。また転送だけでなく、パケットの書き換えや破棄もインストラクションで実行できます。</p>
</li>
<li>
<p>カウンタ: カウンタはフローエントリごとのパケット処理量の記録です。たとえば「リモコン関連の問い合わせ数は9件」とマニュアルに記録したように、「このフローエントリに従って処理したパケットは80個」などといった情報が書き込まれます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>いかがでしょうか?カスタマーサポートとOpenFlowはよく似ていることがわかると思います。実はOpenFlowはとても単純で理解しやすい仕組みなのです。</p>
</div>
</div>
<div class="sect3">
<h4 id="_エアコンがまたまた故障">エアコンがまたまた故障</h4>
<div class="paragraph">
<p>エアコンもしばらくは順調でしたが、1ヶ月後また調子が悪くなってしまいました。友太郎君は再びカスタマーサポートへダイヤルします。</p>
</div>
<div class="paragraph">
<p>「エアコンの排水ホースがすぐ詰まっちゃうんです」</p>
</div>
<div class="paragraph">
<p>青井さんはいつものように手元の対応マニュアルを調べましたが、困ったことに排水ホースの項目は載っていません。どうやらまったく新しい不具合のようです。</p>
</div>
<div class="paragraph">
<p>「すみませんが少々お待ちください。対応可能なサポートがいるかどうか確認いたします」</p>
</div>
<div class="paragraph">
<p>そして電話口には録音された”しばらくお待ちください”のメッセージとどこか軽快な音楽が流れはじめました。</p>
</div>
<div id="yoyodyne_support_miyasaka" class="imageblock">
<div class="content">
<img src="images/how_does_openflow_work/yoyodyne_support_miyasaka.png" alt="yoyodyne support miyasaka">
</div>
<div class="title">図1-3対応マニュアルに対処法が見つからなかった場合、上司に聞く</div>
</div>
<div class="paragraph">
<p>こういう時、青井さんがいつも頼るのは上司の宮坂主任です(<a href="#yoyodyne_support_miyasaka">図1-3</a>)。</p>
</div>
<div class="paragraph">
<p>「宮坂さん、排水ホースについての問い合わせが着てるのですが、どのサポート担当につなげばよいですか?」</p>
</div>
<div class="paragraph">
<p>「それだったら消耗品担当サポートだよ」</p>
</div>
<div class="paragraph">
<p>転送先がわかった青井さんは友太郎君の待つ電話に戻ります。</p>
</div>
<div class="paragraph">
<p>「大変お待たせいたしました。担当のサポートに転送いたします」</p>
</div>
<div class="paragraph">
<p>一度目の問い合わせと比べてかなり時間がかかってしまいましたが、これでようやく一件落着です。さらに青井さんは、宮坂主任から教わった消耗品担当サポートの連絡先をマニュアルに追加します (<a href="#operator_manual_add_row">表1-4</a>)。次からの同じ問い合わせにすばやく答えられるようにするためです。</p>
</div>
<table id="operator_manual_add_row" class="tableblock frame-all grid-all spread">
<caption class="title">表1-4 マニュアルに新しい症状と転送先を追加してアップデートップデートする</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">故障の箇所</th>
<th class="tableblock halign-left valign-top">担当サポートの内線番号</th>
<th class="tableblock halign-left valign-top">問い合わせ件数</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リモコンの不調</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周辺機器担当サポートに転送</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9 件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">エアコン本体の不調</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エアコン担当サポートに転送</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6 件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">室外機の不調</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周辺機器担当サポートに転送</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">いたずら電話</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">電話を切る</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>排水ホースの不調</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>消耗品担当サポートに転送</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1 件</strong></p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_これをopenflowに置き換えると_2">これをOpenFlowに置き換えると…</h5>
<div class="paragraph">
<p>OpenFlowでこの上司にあたるのがコントローラと呼ばれるソフトウェアです(<a href="#openflow_host_switch_controller">図1-4</a>)。OpenFlowでネットワークをプログラミングする場合、プログラマが書くのはこのコントローラの部分です。頭脳であるコントローラをソフトウェアとして記述することで、ネットワークを自由自在に制御できるというわけです。</p>
</div>
<div id="openflow_host_switch_controller" class="imageblock">
<div class="content">
<img src="images/how_does_openflow_work/openflow_host_switch_controller.png" alt="openflow host switch controller">
</div>
<div class="title">図1-4フローテーブルにパケットのエントリーが見つからなかった場合、コントローラに問い合わせる</div>
</div>
<div class="paragraph">
<p>フローテーブルに載っているパケットはスイッチが高速に転送してくれますが、フローテーブルに載っておらずスイッチ側でどう処理してよいかわかない予期せぬパケットが届くこともあります。この場合スイッチはこのパケットをコントローラに上げて「このパケットはどうすればよいですか?」と指示をあおぎます。コントローラはこのパケットの中身を調べ、どうすべきかという指示、つまり新しいフローエントリをフローテーブルに書き込んでやります。</p>
</div>
<div class="paragraph">
<p>このようにフローテーブルに載っていないパケットが届くと、コントローラへの問い合わせが発生するのでパケット転送がとても遅くなります。しかし、スイッチの起動時にコントローラが必要なフローエントリをあらかじめ書き込んでおくようにしておけば、スイッチ側だけで素早く処理できます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">コントローラへの問い合わせはどのくらい遅い?</div>
<div class="paragraph">
<p>フローテーブルを使わずに、毎回コントローラが指示を出すとどうなるでしょうか? 結果は、何倍も遅くなります。試しに手元の環境で簡単なプログラムを書き、ソフトウェアスイッチで転送する場合とコントローラですべて処理する場合を比べてみたところ、性能に5倍もの差が出ました。もちろんこれはおおざっぱな値ですが、数倍は遅くなるという目安になります。また今回の実験はソフトウェアスイッチでしたが、ハードウェアスイッチを使うとこの差はさらに広がります。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_openflowのうれしさ">OpenFlowのうれしさ</h3>
<div class="paragraph">
<p>OpenFlowの仕組みの大枠は理解できたと思います。それでは最も肝心な部分、「OpenFlowって何がうれしいの?」を掘り下げてみましょう。</p>
</div>
<div class="sect3">
<h4 id="_自動化やシステム連携がしやすい">自動化やシステム連携がしやすい</h4>
<div class="paragraph">
<p>カスタマーサポートセンターでは、あらかじめ適切なマニュアルを作っておけば業務はすべて電話サポートが自動的にやってくれます。これによって、全体の監督は管理職で実務は電話サポート、というふうにきっちりと分業できるようになります。たとえば電話サポートが実務をやってくれている間、管理職は他の部署との協業や調整に集中できます。</p>
</div>
<div class="paragraph">
<p>同様に、OpenFlowスイッチの制御はすべてソフトウェアであるコントローラで実現しているので、ネットワーク管理の自動化が用意です。さらにコントローラがRubyやPython、Javaなどよく知られた汎用言語で書いてあれば、既存のシステムやサービスなどとの連携も簡単です。たとえば、アプリケーションからの要求やビジネスポリシーの変更、問題発生などさまざまなトリガーに応じてネットワークの設定を変更するといった、一歩進んだ自動化もできます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>システム連携の一例として、コントローラとWebサーバ(Sinatra)を連携してコントローラにREST APIを実装する方法を第14章で解説します。また、実際のデータセンターでのコントローラと外部サービスの連携については第15章および16章で紹介します。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ネットワークトラフィックを集中制御しやすい">ネットワークトラフィックを集中制御しやすい</h4>
<div class="paragraph">
<p>カスタマーサポートセンターでは問い合わせ件数の情報はすべて管理職に上がってくるため、混み具合の把握や全体の交通整理が楽です。もし特定のサポートに問い合わせが集中しても、問い合わせがうまくばらけるようにマニュアルを通じて電話サポートの全員に指示できます。反対にもし各サポートが個々に判断してしまうと、おなじサポートに問い合わせが偏ることは避けられません。</p>
</div>
<div class="paragraph">
<p>OpenFlowでもすべてのトラフィック情報はコントローラに上がってくるため、全体を見たトラフィックの最適化が可能です。各種カウンタを集計することで、コントローラはネットワーク全体のトラフィックデータを集められます。そしてその情報をもとに各スイッチのフローテーブルを更新することで、全体的に見て最適となるパケットの通り道を引けます。反対にもし個々のスイッチが判断してしまうと、うまくトラフィックを分散できません。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>各種カウンタの収集方法については第4章で、またトラフィックの分散方法については第13章で解説します。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ソフトウェア開発のテクニックやツールが使える">ソフトウェア開発のテクニックやツールが使える</h4>
<div class="paragraph">
<p>コントローラはソフトウェアの一種なので、ソフトウェア開発で長年培われているさまざまなテクニックやツールをネットワーク構築に応用できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>近年主流のアジャイル開発手法でコントローラを開発すれば、反復的な機能追加が可能。フィードバックを受けながら少しずつバージョンアップしてくことで、ネットワークを段階的に構築できる</p>
</li>
<li>
<p>コントローラのユニットテストや受け入れテストを書くことで、ネットワーク全体を自動的にテストできる。テスト結果の出力は、そのまま仕様書の一部になる。ExcelやWordで書いた仕様書を別個に管理する必要はない</p>
</li>
<li>
<p>コントローラのソースコードや関連データをgitなどのバージョン管理ツールで管理すれば、ネットワーク全体のバージョン管理やバージョン間の差分のチェック、および巻き戻しも可能</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>アジャイルやソフトウェアテストによるコントローラ開発手法については第7章で解説します。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_負荷上昇に対してスケールしやすい">負荷上昇に対してスケールしやすい</h4>
<div class="paragraph">
<p>従来のネットワーク専用機器をOpenFlowコントローラで置き換えれば、負荷上昇への対応がより柔軟になります。従来のファイアウォールやルータ、スイッチ、ロードバランサといった専用ネットワーク機器では、負荷が上がった際にはワンランク上のハイエンドな機器との置き換え、つまり垂直方向のアップグレードしか選択肢がありませんでした。しかし、専用機器をコントローラとしてソフトウェア実装できれば、汎用サーバ上にほぼ同様の機能を実装できることになります。そして、汎用サーバを増やすだけで、つまり水平方向に増設するだけで負荷上昇に対応できます。これを一般にNFV(Network Functions Virtualization)と呼びます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>従来のファイアウォールやルータ、スイッチといった専用機器は、ベンダが提供する機能をそのまま使うしかありませんでした。たとえば、100個ある機能のうち、本当に使いたい機能は10個だけだったとしても、100機能付きのルータを買うしかありません。これではある意味、フルコースしか頼めないフレンチレストランのようなものです。一部の機能しか利用していないのに障害ポイントが無数にあるので、切り分けやデバッグが難航することもままあります。</p>
</div>
<div class="paragraph">
<p>OpenFlowは回転ずしです。フランス料理の味に近づけるのは大変ですが、必要な機能だけをチョイスしてがんばって実装すれば、思い通りの機器が手に入るのです。</p>
</div>
<div class="paragraph">
<p>こうしたネットワーク機器のOpenFlow実装については、パッチパネルを第5章で、スイッチを第6章で、ファイアウォールを第9章で、ルータを第10, 11章でそれぞれ解説します。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_openflowで気をつけること">OpenFlowで気をつけること</h3>
<div class="paragraph">
<p>もちろん、OpenFlowでもうれしいことばかりではありません。コントローラで制御を一手に引き受けるというモデルになっているため、スイッチの台数が増えたときのコントローラの負荷に気をつける必要があります。もし、フローテーブルに載っていないパケットが一気にコントローラへ到着すると、パケットの配送が遅延するか最悪の場合コントローラが停止してしまいます。</p>
</div>
<div class="paragraph">
<p>そこで、OpenFlowの使いどころやフローテーブルの残り容量にはとくに注意する必要があります。たとえばOpenFlowをインターネットのような多種多様のパケットが流れる環境につなげると、すぐにコントローラへの問い合わせが殺到しフローテーブルがいっぱいになって破綻してしまいます。しかしデータセンターなどの閉じた環境では、トラフィックの特徴や流れるパケットの種類はあらかじめ見当を付けておけます。そこで最低限のパケットのみがコントローラへ上がってくるようにうまくネットワークとフローエントリを設計することで、スイッチが増えてもスケールさせることができます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_まとめ">まとめ</h3>
<div class="paragraph">
<p>本章ではSDNを実現するための部品であるOpenFlowを解説しました。OpenFlowはフローテーブルを持つスイッチと、フローテーブルの内容を集中制御するソフトウェアであるコントローラから成ります。ネットワークの制御をソフトウェア化することによって、自動化やさざまななシステムとの連携、トラフィック制御のしやすさ、ソフトウェア技術の応用、ソフトウェアならではのスケーラビリティの高さ、などさまざまな恩恵があります。</p>
</div>
<div class="paragraph">
<p>では、さっそくOpenFlowプログラミングを始めてみましょう!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hello_trema">Hello, Trema!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Trema(トレマ)を使うと楽しくSDNの世界が味わえます。これでいよいよあなたもOpenFlowプログラマの仲間入りです!</p>
</div>
<div class="sect2">
<h3 id="_作ってわかるopenflow">作ってわかるOpenFlow</h3>
<div class="paragraph">
<p>いよいよOpenFlowを使ってネットワークを実際にプログラムしていきます。職場や自宅のような小規模ネットワークでもすぐに試せるコードを通じてOpenFlowの世界を体験しましょう。実際に手を動かし実行してみれば「OpenFlowってどんな場面で使えるの？」というよくある疑問も徐々に氷解していくでしょう。</p>
</div>
<div class="paragraph">
<p>実装はステップバイステップで進みます。どのステップも実用的な例となっており、最初はOpenFlowやプログラミングの基礎から始めます。そしてパッチパネルやL2スイッチ、ファイアウォール、ルータの実装など徐々に複雑な機能へとステップアップし、最終的にはデータセンターでも動く本格的な「ネットワーク仮想化」の実装を目標とします。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hello Trema (本章): OpenFlow 版 Hello World</p>
</li>
<li>
<p>cbenchベンチマーク  (3章): OpenFlow のマイクロベンチマークツール</p>
</li>
<li>
<p>スイッチ監視ツール (4章): スイッチのスペックや転送量のモニタリングツール</p>
</li>
<li>
<p>パッチパネル (5章): ソフトウェアとして実装したインテリジェント・パッチパネル</p>
</li>
<li>
<p>ラーニングスイッチ  (6章): レイヤ2スイッチをエミュレートするコントローラ</p>
</li>
<li>
<p>テスト駆動開発 (7章): リピータハブのテスト駆動開発</p>
</li>
<li>
<p>ブリッジ (8章): レガシーなネットワークとOpenFlowネットワークのブリッジ</p>
</li>
<li>
<p>ファイアウォール (9章): 透過型ファイアウォール</p>
</li>
<li>
<p>ルータ (10章,11章): 基本的なレイヤ3スイッチ (ルータ)</p>
</li>
<li>
<p>トポロジ (12章): 中規模〜大規模ネットワークのトポロジ検知</p>
</li>
<li>
<p>ルーティングスイッチ (13章): 中規模〜大規模ネットワーク用の仮想レイヤ2スイッチ</p>
</li>
<li>
<p>スライサブルスイッチ (14章): ルーティングスイッチに仮想ネットワーク機能を追加</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>まずは、OpenFlowプログラミングのためのフレームワーク、Tremaを改めて紹介します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_tremaとは">Tremaとは</h3>
<div class="paragraph">
<p>TremaはOpenFlowコントローラを開発するためのフリーソフトウェアです。GitHub上でオープンに開発しており、ライセンスはGPL2のフリーソフトウェアです。その強力な機能や使いやすさから、国内外の企業や大学および研究機関などで採用されています。</p>
</div>
<div class="paragraph">
<p>Tremaの情報はおもに次のURLから入手できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tremaホームページ: <a href="https://trema.github.com/trema/" class="bare">https://trema.github.com/trema/</a></p>
</li>
<li>
<p>GitHubのプロジェクトページ: <a href="https://github.com/trema/" class="bare">https://github.com/trema/</a></p>
</li>
<li>
<p>メーリングリスト: <a href="http://groups.google.com/group/trema-dev/" class="bare">http://groups.google.com/group/trema-dev/</a></p>
</li>
<li>
<p>Twitterアカウント: <a href="https://twitter.com/trema_news" class="bare">https://twitter.com/trema_news</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tremaの特徴は「プログラミングフレームワーク」をうたっていることです。いったいこれは何でしょうか?</p>
</div>
<div class="paragraph">
<p>Webプログラミングを多少かじったことがあれば、プログラミングフレームワークと聞くとRuby on Rails <span class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</span>を真っ先に思い浮かべるでしょう。Railsの登場以前、90年代半ばには原始的なCGIプログラミングがWeb開発の主流でした。HTTPプロトコルを意識した低レベルなコードをCやPerlで書かねばならず、ごく単純な掲示板サービスを作るのにも大量のコーディングが伴いました。しかし2000年代に入り、より生産性の高い開発手法 — プログラミングフレームワークによるアジャイル開発 — によって一気にWebサービスは「カンブリア爆発」を迎えました。Railsを代表とするWebプログラミングフレームワークは、HTTPプロトコルの詳細を抽象化した高レベルなAPIを提供します。また、RubyやPythonをはじめとするスクリプティング言語の採用や、開発全体をラップトップPC1台で完結できる数々の開発支援ツールの提供によって、生産性を劇的に向上しました。</p>
</div>
<div class="paragraph">
<p>この流れをOpenFlow界にも吹き込んだのがTremaです。Tremaは「OpenFlow版Rails」を合言葉として、2011年に初のOpenFlowプログラミングフレームワークとして登場しました。開発言語にはRailsと同じくRubyを採用し、また高レベルなOpenFlow APIを提供することで、プログラマはごく短いコードでOpenFlowコントローラを実装できます。また強力なOpenFlow開発ツール群を提供することで、ソフトウェアテストを中心とした反復的で段階的なアジャイル開発を可能にします。</p>
</div>
<div class="paragraph">
<p>こうした強力なツールの一つがTremaの仮想ネットワーク機能です。OpenFlowスイッチを持っていない開発者でも、Tremaを使えばラップトップPC一台の中に仮想的なOpenFlowネットワークを作り、そこで自分の開発したコントローラを実行できます。この「作ったものをすぐに実行できる」という利点は、生産性の向上だけでなくSDNやOpenFlowのような新しい技術の習得にもつながります。正しい理解のためには概念の理解に加えて実践、つまり実際に手を動かすことが欠かせないからです。</p>
</div>
<div class="paragraph">
<p>ここからは実際にTremaを使ってOpenFlowコントローラを作り、そして動かしていきます。まずはTremaの実行環境をセットアップしましょう。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Tremaの由来は?</div>
<div class="paragraph">
<p>Tremaの名前は、著者の一人がファンである「とれまレコード (<a href="http://www.fumiyatanaka.com/toremarecords/" class="bare">http://www.fumiyatanaka.com/toremarecords/</a>) 」という大阪の小さなレコードレーベルの名前から来ています。とれまレコードのリリースする楽曲は国内よりもむしろ海外で人気があり、海外のクラブチャートにもよくランクインします。</p>
</div>
<div class="paragraph">
<p>この「とれまレコード」の名前にも面白い由来があります。日本がバブルの頃、道路の「とまれ」という標示がよく「とれま」と間違えて描かれており、これに目をつけたレーベルオーナーが「とれまレコード」と名付けたのだそうです。そしてもともと、このありえないミスの原因は、バブル景気時代に急増した外国人労働者達が、日本語もままならないまま工事現場で働いていたということにあります。</p>
</div>
<div id="trema_logo" class="imageblock">
<div class="content">
<img src="images/openflow_framework_trema/trema_logo.png" alt="trema logo">
</div>
<div class="title">図2-aTremaの公式ロゴ</div>
</div>
<div class="paragraph">
<p>この逸話にのっとって、Tremaの公式ロゴも<a href="#trema_logo">図2-a</a>のとおり道路標識の写真になっています。ちなみに、こんな道路標識は日本中どこを探してもありません! 本書の編集者が画像編集ソフトで試しに作ってみたところ評判が良かったので、そのまま公式ロゴになりました。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_trema実行環境のセットアップ">Trema実行環境のセットアップ</h3>
<div class="paragraph">
<p>TremaはLinux用のソフトウェアです。次のLinuxディストリビューションでの動作を確認しています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ubuntu (i386/amd64)</p>
</li>
<li>
<p>Debian GNU/Linux (i386/amd64)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>なお動作保証はしていませんが、CentOSやFedoraをはじめとするRedHat系Linuxディストリビューションでの動作も確認しています。</p>
</div>
<div class="paragraph">
<p><code>trema</code> コマンドの実行には sudo 権限が必要です。あらかじめ、<code>sudo</code> を使って root 権限でコマンドを実行できるかどうか、<code>sudo</code> の設定ファイルを確認しておいてください。</p>
</div>
<div class="paragraph">
<p><code>sudo</code> が正しく設定できることを確認したら、Tremaの実行に必要な次のソフトウェアをインストールします。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rubyインタプリタ : Tremaの実行にはRubyのバージョン2.0以降が必要です。Tremaを使ったコントローラの開発にもRubyを使います。</p>
</li>
<li>
<p>Bundler (<a href="https://bundler.io/" class="bare">https://bundler.io/</a>) : Rubyライブラリのインストーラです。bundlerを使ってTrema本体と実行に必要なライブラリをインストールします。</p>
</li>
<li>
<p>Open vSwitch (<a href="http://openvswitch.org/" class="bare">http://openvswitch.org/</a>) : OpenFlowに対応したソフトウェアスイッチの一種です。Tremaの仮想ネットワーク機能で使用します。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_rubyとbundlerのインストール">RubyとBundlerのインストール</h4>
<div class="paragraph">
<p>Rubyのインストールには、RVM<span class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</span>というRubyインストーラを使うのが手軽です。次のコマンドを実行すると、安定版のRubyを自動的にインストールしてくれます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -sSL https://get.rvm.io | bash -s stable --ruby</pre>
</div>
</div>
<div class="paragraph">
<p>Bundlerは次のコマンドでインストールできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gem install bundler</pre>
</div>
</div>
<div class="paragraph">
<p>なお <code>gem</code> はRubyの標準ライブラリ形式 <code>.gem</code> をインストールするコマンドです。ここでは最新版のBundlerの <code>.gem</code> を自動的にダウンロードしてインストールしています。</p>
</div>
</div>
<div class="sect3">
<h4 id="_open_vswitchのインストール">Open vSwitchのインストール</h4>
<div class="paragraph">
<p>Open vSwitchは <code>apt-get</code> で簡単にインストールできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ sudo apt-get install openvswitch-switch</pre>
</div>
</div>
<div class="paragraph">
<p>他のディストリビューションを使う場合は、コマンド名やパッケージ名を適宜読み替えてください。</p>
</div>
<div class="paragraph">
<p>以上でTremaを使うための準備が整いました。それでは早速、入門の定番Hello, Worldを書いて実行してみましょう。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hello_trema_2">Hello, Trema!</h3>
<div class="paragraph">
<p>「Hello Trema!」は最も簡単なOpenFlowコントローラです。その唯一の機能は、スイッチと接続し「Hello, 0xabc!(0xabcはスイッチのDatapath ID)」と表示するだけです。このように機能は単純ですが、そのソースコードはTremaでコントローラを作るのに必要な基本知識をすべて含んでいます。</p>
</div>
<div class="sect3">
<h4 id="_hello_tremaを書く">Hello Tremaを書く</h4>
<div class="paragraph">
<p>コントローラの実装はプロジェクト用ディレクトリを作ることから始めます。まずは次のように、「Hello Trema!」用の空のディレクトリhello_tremaと、ソースコード用ディレクトリhello_trema/libを <code>mkdir -p</code> コマンドで新たに作ってください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mkdir -p hello_trema/lib
$ cd hello_trema</pre>
</div>
</div>
<div class="sect4">
<h5 id="_プロジェクトディレクトリの中身">プロジェクトディレクトリの中身</h5>
<div class="paragraph">
<p>プロジェクトディレクトリには、コントローラに関連するすべてのファイルを置きます。コントローラのソースコードをはじめ、README.mdやLICENSEといったドキュメント類、コントローラの動作をテストするためのテストファイル、そして各種設定ファイルがここに入ります。</p>
</div>
<div class="paragraph">
<p>プロジェクトディレクトリのお手本として、GitHubのtrema/hello_tremaリポジトリ(<a href="https://github.com/trema/hello_trema" class="bare">https://github.com/trema/hello_trema</a>) を見てみましょう。このリポジトリは、標準的なRubyプロジェクトのファイル構成に従っています。次に主要なファイルを挙げます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>README.md: メインのドキュメント</p>
</li>
<li>
<p>LICENSE: 配布ライセンスの指定</p>
</li>
<li>
<p>CHANGELOG.md: 開発履歴</p>
</li>
<li>
<p>Gemfile: 必要なgemパッケージの定義</p>
</li>
<li>
<p>Rakefile: 開発用タスク</p>
</li>
<li>
<p>lib/: コントローラの実装</p>
</li>
<li>
<p>features/: 受け入れテスト</p>
</li>
<li>
<p>spec/: ユニットテスト</p>
</li>
<li>
<p>tasks/: 開発用タスク定義</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>自分で作ったコントローラを公開する場合、このようなファイル構成にすることが求められます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>テスト関連のディレクトリ(features/, spec/, tasks/)の用途については、第7章「テスト駆動開発」で詳しく説明します。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_コントローラ本体の実装">コントローラ本体の実装</h5>
<div class="paragraph">
<p>エディタでhello_tremaディレクトリ内のlib/hello_trema.rbを開き次のRubyコードを入力してください。.rbはRubyプログラムの標準的な拡張子です。Rubyの文法は必要に応じておいおい説明しますので、もしわからなくても気にせずそのまま入力してください。</p>
</div>
<div class="listingblock">
<div class="title">lib/hello_world.rb</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="comment"># Hello World!</span>
<span class="keyword">class</span> <span class="class">HelloTrema</span> &lt; <span class="constant">Trema</span>::<span class="constant">Controller</span>
  <span class="keyword">def</span> <span class="function">start</span>(_args)
    logger.info <span class="string"><span class="delimiter">'</span><span class="content">Trema started.</span><span class="delimiter">'</span></span>
  <span class="keyword">end</span>

  <span class="keyword">def</span> <span class="function">switch_ready</span>(datapath_id)
    logger.info <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">#{</span>datapath_id.to_hex<span class="inline-delimiter">}</span></span><span class="content">!</span><span class="delimiter">&quot;</span></span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_スイッチの定義">スイッチの定義</h5>
<div class="paragraph">
<p>Hello Tremaの実行にはOpenFlowスイッチが1台必要です。さきほどインストールしたOpen vSwitchをHello Tremaコントローラに接続することにしましょう。次の設定ファイルtrema.confをエディタで作成してください。</p>
</div>
<div class="listingblock">
<div class="title">trema.conf</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">vswitch { datapath_id <span class="integer">0xabc</span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>この設定ファイルでは0xabcというDatapath IDを持つ1台のソフトウェアスイッチを定義しています。コントローラを実行する際にこの設定ファイルを指定することで、Open vSwitchを起動しコントローラに接続できます。</p>
</div>
</div>
<div class="sect4">
<h5 id="_tremaのインストール">Tremaのインストール</h5>
<div class="paragraph">
<p>Hello Tremaの実行にはもちろんTremaが必要です。実行に必要なRubyのアプリケーションやライブラリを`Gemfile`というファイルに次のように書いておくと、Hello Trema専用の実行環境を自動的にセットアップできます。</p>
</div>
<div class="listingblock">
<div class="title">Gemfile</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">source <span class="string"><span class="delimiter">'</span><span class="content">https://rubygems.org/</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>

gem ‘trema’ <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>gemの取得元として標準的なhttps://rubygems.orgを指定します</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>実行環境にTremaを追加します</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>次のコマンドを実行すると、Tremaの実行コマンドがbin/tremaにインストールされます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ bundle install --binstubs
$ ./bin/trema --version
trema version 0.5.1</pre>
</div>
</div>
<div class="paragraph">
<p>実行に最低限必要なコードはこれだけです。それでは細かい部分は後で説明するとして「習うより慣れろ」でさっそく実行してみましょう。</p>
</div>
</div>
<div class="sect4">
<h5 id="_実行してみよう_trema_run">実行してみよう(trema run)</h5>
<div class="paragraph">
<p>作成したコントローラは <code>trema run</code> コマンドですぐに実行できます。Rubyはインタプリタ言語なので、コンパイルの必要はありません。ターミナルで次のように入力すると、この世界一短いOpenFlowコントローラはフォアグラウンドプロセスとして起動し、画面に「Trema started」「Hello, 0xabc!」と出力します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./bin/trema run ./lib/hello_trema.rb -c trema.conf
Trema started.
Hello, 0xabc! <i class="conum" data-value="1"></i><b>(1)</b>
$</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Ctrl + c</code> でコントローラを終了</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ここまで見てきたように、<code>trema</code> コマンドを使うと、とても簡単にコントローラを実行できます。<code>trema</code> コマンドには他にもいくつかの機能がありますので、ここで簡単に紹介しておきましょう。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_trema_コマンド">trema コマンド</h3>
<div class="paragraph">
<p><code>trema</code> コマンドは Trema 唯一のコマンドラインツールであり、コントローラの起動やテストなどさまざまな用途に使います。</p>
</div>
<div class="paragraph">
<p>たとえば先ほどの「Hello, Trema!」で見たように、<code>trema run</code> はコントローラを起動するためのコマンドです。起動したコントローラは OpenFlow スイッチと接続しメッセージをやりとりします。また、<code>trema run</code> コマンドは <code>-c</code> (<code>--conf</code>) オプションで仮想ネットワークを作ることもでき、作ったコントローラをこの仮想ネットワークの中でテストできます(<a href="#trema_run_command">図2-1</a>)。</p>
</div>
<div id="trema_run_command" class="imageblock">
<div class="content">
<img src="images/openflow_framework_trema/trema_overview.png" alt="trema overview">
</div>
<div class="title">図2-1trema runコマンドの実行イメージ</div>
</div>
<div class="paragraph">
<p><code>trema</code> コマンドは <code>git</code> や <code>svn</code> コマンドと似たコマンド体系を持っており、<code>trema</code> に続けて <code>run</code> などのサブコマンドを指定することでさまざまな機能を呼び出します。<code>trema</code> コマンドは Trema フレームワークにおける中心的なツールで、あらゆるコントローラ開発の出発点と言えます。こうしたコマンド体系を一般に「コマンドスイート」と呼びます。</p>
</div>
<div class="paragraph">
<p>一般的なコマンドスイートと同じく、サブコマンドの一覧は <code>trema help</code> で表示できます。また、サブコマンド自体のヘルプは <code>trema help [サブコマンド]</code> で表示できます。以下に、<code>trema help</code> で表示されるサブコマンド一覧をざっと紹介しておきます。いくつかのサブコマンドはまだ使い方を紹介していませんが、続く章で説明しますので今は目を通すだけでかまいません。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>trema run</code>
 コントローラをフォアグラウンドで実行する。<code>--daemonize</code> (<code>-d</code>) オプションを付けることで、コントローラをバックグラウンド (デーモンモード) として実行できる</p>
</li>
<li>
<p><code>trema version</code>
 Trema のバージョンを表示する。<code>trema --version</code> と同じ</p>
</li>
<li>
<p><code>trema killall</code>
 バックグラウンドで起動している Trema プロセス全体を停止する</p>
</li>
<li>
<p><code>trema kill</code>
 仮想ネットワーク内の指定したスイッチまたはスイッチポートを停止する</p>
</li>
<li>
<p><code>trema up</code>
 仮想ネットワークの指定したスイッチまたはスイッチポートを再び有効にする章)</p>
</li>
<li>
<p><code>trema send_packets</code>
 仮想ネットワーク内でテストパケットを送信する</p>
</li>
<li>
<p><code>trema show_stats</code>
 仮想ネットワーク内の仮想ホストで送受信したパケットの統計情報を表示する○章)</p>
</li>
<li>
<p><code>trema reset_stats</code>
 仮想ネットワーク内の仮想ホストで送受信したパケットの統計情報をリセットする(第○章)</p>
</li>
<li>
<p><code>trema dump_flows</code>
 仮想ネットワーク内の仮想スイッチのフローテーブルを表示する</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>では、気になっていた Ruby の文法にそろそろ進みましょう。今後はたくさん Ruby を使いますが、その都度必要な文法を説明しますので心配はいりません。しっかりついてきてください。</p>
</div>
</div>
<div class="sect2">
<h3 id="_即席ruby入門">即席Ruby入門</h3>
<div class="paragraph">
<p>Rubyを習得する一番の近道は、コードを構成する各要素の種類(品詞)を押さえることです。これは、外国語を習得するコツに近いものがあります。ただし外国語と違い、Rubyの構成要素にはその品詞を見分けるための視覚的なヒントがかならずあります。このためRubyのコードはずいぶんと読みやすくなっています。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">品詞</th>
<th class="tableblock halign-left valign-top">視覚的ヒント</th>
<th class="tableblock halign-left valign-top">例</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">定数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">大文字で始まる</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HelloTrema, Trema::Controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">インスタンス変数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@で始まる</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@switches, @name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">シンボル</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">:で始まる</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">:match, :actions</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>インスタンス変数とシンボルの使いかたについては、後の章で詳しく説明します。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>このように最初の文字を見れば、それがどんな品詞かすぐにわかります。たとえば、大文字で始まる名前はかならず定数です。品詞がわかれば、そのRubyコードがどんな構造かも見えてきます。これからそれぞれの品詞について簡単に説明しますが、最初からすべてが理解できなくとも構いません。しばらくすれば「Hello, Trema!」のあらゆる部分が識別できるようになっているはずです。</p>
</div>
<div class="sect3">
<h4 id="_定数">定数</h4>
<div class="paragraph">
<p><code>HelloTrema</code> や <code>Trema::Controller</code> など、大文字で始まる名前が定数です。Rubyの定数は英語や日本語といった自然言語における固有名詞にあたります。</p>
</div>
<div class="listingblock">
<div class="title">lib/hello_world.rb</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="comment"># Hello World!</span>
<span class="keyword">class</span> <span class="class">HelloTrema</span> &lt; <span class="constant">Trema</span>::<span class="constant">Controller</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="keyword">def</span> <span class="function">start</span>(_args)
    logger.info <span class="string"><span class="delimiter">'</span><span class="content">Trema started.</span><span class="delimiter">'</span></span>
  <span class="keyword">end</span>

  <span class="keyword">def</span> <span class="function">switch_ready</span>(datapath_id)
    logger.info <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">#{</span>datapath_id.to_hex<span class="inline-delimiter">}</span></span><span class="content">!</span><span class="delimiter">&quot;</span></span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>この行の <code>HelloTrema</code> と <code>Trema::Controller</code> が定数</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>英語でも固有名詞は大文字で始めることになっています。たとえばTokyo Tower(東京タワー)もそうです。東京タワーは動かすことができませんし、何か別なものに勝手に変えることもできません。このように、固有名詞は時間とともに変化しないものを指します。そして固有名詞と同様、Rubyの定数は一度セットすると変更できません。もし変更しようとすると、次のように警告が出ます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ irb
&gt; TokyoTower = "東京都港区芝公園4丁目2-8"
&gt; TokyoTower = "増上寺の近く"
(irb):2: warning: already initialized constant TokyoTower
(irb):1: warning: previous definition of TokyoTower was here
=&gt; "東京都港区芝公園4丁目2-8"</pre>
</div>
</div>
<div class="paragraph">
<p><code>class</code> に続く定数はクラス定義です。「Hello, Trema!」の例では <code>HelloTrema</code> が定義されるクラス名です。「<code>class</code> +クラス名」から始まるクラス定義は、同じ字下げレベルの <code>end</code> までの範囲です。</p>
</div>
<div class="listingblock">
<div class="title">lib/hello_trema.rb</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="keyword">class</span> <span class="class">HelloTrema</span> &lt; <span class="constant">Trema</span>::<span class="constant">Controller</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="keyword">def</span> <span class="function">start</span>(args)
    logger.info <span class="string"><span class="delimiter">&quot;</span><span class="content">Trema started.</span><span class="delimiter">&quot;</span></span>
  <span class="keyword">end</span>

  <span class="keyword">def</span> <span class="function">switch_ready</span>(datapath_id)
    logger.info <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">#{</span>datapath_id.to_hex<span class="inline-delimiter">}</span></span><span class="content">!</span><span class="delimiter">&quot;</span></span>
  <span class="keyword">end</span>
<span class="keyword">end</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>HelloTremaクラス定義の始まり</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>クラス定義の終わり</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_コントローラクラスの継承">コントローラクラスの継承</h5>
<div class="paragraph">
<p>Tremaではすべてのコントローラはクラスとして定義し、Tremaの提供する <code>Trema::Controller</code> クラスをかならず継承します。クラスを継承するには、<code>class クラス名 &lt; 親クラス名</code> と書きます.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="keyword">class</span> <span class="class">HelloTrema</span> &lt; <span class="constant">Trema</span>::<span class="constant">Controller</span> <i class="conum" data-value="1"></i><b>(1)</b>
  ...
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Trema::Controller</code> クラスを継承した <code>HelloTrema</code> クラスを定義</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Trema::Controller</code> クラスを継承することで、コントローラに必要な基本機能が <code>HelloTrema</code> クラスにこっそりと追加されます。たとえば雑多な初期化などの裏仕事を <code>Trema::Controller</code> クラスが代わりにやってくれるわけです。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ハンドラの定義">ハンドラの定義</h4>
<div class="paragraph">
<p>さて、こうして定義した <code>HelloTrema</code> クラスはどこから実行が始まるのでしょうか? Cで言う <code>main()</code> 関数に当たるものがどこにも見あたりません。</p>
</div>
<div class="paragraph">
<p>その答はTremaの動作モデルであるイベントドリブンモデルにあります。Tremaのコントローラは、さまざまなOpenFlowイベントに反応するイベントハンドラメソッド(以下、ハンドラと呼びます)をまとめたクラスとして定義します。</p>
</div>
<div class="paragraph">
<p>ハンドラの定義は <code>def</code> に続く名前から <code>end</code> までのブロックです。たとえば <code>HelloTrema</code> の例では <code>start</code> と <code>switch_ready</code> ハンドラを定義しています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="keyword">class</span> <span class="class">HelloTrema</span> &lt; <span class="constant">Trema</span>::<span class="constant">Controller</span>
  <span class="keyword">def</span> <span class="function">start</span>(args) <i class="conum" data-value="1"></i><b>(1)</b>
    logger.info <span class="string"><span class="delimiter">&quot;</span><span class="content">Trema started.</span><span class="delimiter">&quot;</span></span>
  <span class="keyword">end</span>

  <span class="keyword">def</span> <span class="function">switch_ready</span>(datapath_id) <i class="conum" data-value="2"></i><b>(2)</b>
    logger.info <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">#{</span>datapath_id.to_hex<span class="inline-delimiter">}</span></span><span class="content">!</span><span class="delimiter">&quot;</span></span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>start</code> ハンドラの定義</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>switch_ready</code> ハンドラの定義</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>それぞれのイベントハンドラは、対応するイベントが発生したときに自動的に呼び出されます。たとえば <code>start</code> ハンドラはコントローラの起動イベント発生時、つまり <code>trema run</code> でコントローラを起動したときに自動的に呼ばれます。また、Packet Inメッセージ(第3章)が到着したとき、もし <code>packet_in</code> ハンドラがコントローラクラスに定義されていれば、Tremaが <code>packet_in</code> ハンドラを自動的に呼びます。</p>
</div>
<div class="paragraph">
<p>Tremaでよく使うイベントをリストアップしておきます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>start</code>
 コントローラの起動時に呼ばれる</p>
</li>
<li>
<p><code>switch_ready</code>
 スイッチがコントローラに接続したときに呼ばれる</p>
</li>
<li>
<p><code>switch_disconnected</code>
 スイッチがコントローラから切断したときに呼ばれる(第4章)</p>
</li>
<li>
<p><code>packet_in</code>
 未知のパケットが到着したというPacket Inメッセージ到着時に呼ばれる(第3章)</p>
</li>
<li>
<p><code>flow_removed</code>
 フローが消されたときのFlow Removedメッセージ到着時に呼ばれる(第6章)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">ハンドラの自動呼び出し</div>
<div class="paragraph">
<p>「ハンドラメソッドを定義しただけで、なぜ自動的に呼び出せるんだろう?」と不思議に思う人もいるでしょう。コード中にどんなメソッドがあるか? というコンパイル時情報をプログラム自身が実行時に知るためには、言語処理系の助けが必要です。たとえばCではコンパイル時と実行時の間にはぶ厚いカーテンが引かれているので普通は無理です。</p>
</div>
<div class="paragraph">
<p>Rubyではオブジェクトが自らの持つメソッドを実行時に調べることができます。これをイントロスペクション(リフレクションや自己反映計算などとも言う)と呼びます。たとえばPacket Inメッセージが到着したとき、コントローラはイントロスペクションして自分が <code>packet_in</code> メソッドを持っているかどうかを実行時に調べます。そしてもし見つかればそのメソッドを呼ぶというわけです。</p>
</div>
<div class="paragraph">
<p>この仕組みは <code>Trema::Controller</code> クラスを継承したときに自動的にコントローラへ導入されます。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_キーワード">キーワード</h4>
<div class="paragraph">
<p>Rubyにはたくさんの組込みの語があり、それぞれに意味が与えられています。これらの語を変数として使ったり、自分の目的に合わせて意味を変えたりはできません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>alias and BEGIN begin break case class def defined do else elsif END
end ensure false for if in module next nil not or redo rescue retry
return self super then true undef unless until when while yield</pre>
</div>
</div>
<div class="paragraph">
<p>このうち、「Hello, Trema!」では <code>class</code> と <code>def</code> そして <code>end</code> キーワードを使いました。先ほど説明したように、<code>class</code> キーワードは続く名前 (<code>HelloTrema</code>) のクラスを定義します。<code>def</code> キーワードは続く名前(<code>start</code>) のメソッドを定義します。</p>
</div>
<div class="paragraph">
<p>この <code>def</code> や <code>class</code> で始まって <code>end</code> で終わる領域のことをブロックと呼びます。すべてのRubyプログラムはこのブロックがいくつか組み合わさったものです。</p>
</div>
</div>
<div class="sect3">
<h4 id="_スイッチの起動を捕捉する">スイッチの起動を捕捉する</h4>
<div class="paragraph">
<p>新しくスイッチが起動すると <code>switch_ready</code> メソッドが起動します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="keyword">def</span> <span class="function">switch_ready</span>(dpid)
  logger.info <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">#{</span>dpid.to_hex<span class="inline-delimiter">}</span></span><span class="content">!</span><span class="delimiter">&quot;</span></span>
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>switch_ready</code> メソッドでは、接続したスイッチのDatapath IDを16進形式(0xで始まる文字列)でログに出力します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">switch_readyの中身</div>
<div class="paragraph">
<p>実は OpenFlow の仕様には <code>switch_ready</code> というメッセージは定義されていません。実は、これは Trema が独自に定義するイベントなのです。<code>switch_ready</code> の裏では<a href="#switch_ready">図2-b</a>に示す一連の複雑な処理が行われていて、Trema がこの詳細をうまくカーペットの裏に隠してくれているというわけです。</p>
</div>
<div id="switch_ready" class="imageblock">
<div class="content">
<img src="images/openflow_framework_trema/switch_ready.png" alt="switch ready">
</div>
<div class="title">図2-bswitch_ready イベントが起こるまで</div>
</div>
<div class="paragraph">
<p>最初に、スイッチとコントローラがしゃべる OpenFlow プロトコルが合っているか確認します。OpenFlow の Hello メッセージを使ってお互いにプロトコルのバージョンを知らせ、うまく会話できそうか判断します。</p>
</div>
<div class="paragraph">
<p>次は、スイッチを識別するための Datapath ID の取得です。Datapath IDのようなスイッチ固有の情報は、スイッチに対して OpenFlow の Features Request メッセージを送ることで取得できます。成功した場合、Datapath IDやポート数などの情報が Features Reply メッセージに乗ってやってきます。</p>
</div>
<div class="paragraph">
<p>最後にスイッチを初期化します。スイッチに以前の状態が残っているとコントローラが管理する情報と競合が起こるので、スイッチを初期化することでこれを避けます。</p>
</div>
<div class="paragraph">
<p>これら一連の処理が終わると、ようやく <code>switch_ready</code> がコントローラに通知されるというわけです。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_datapath_idを16進形式にする">Datapath IDを16進形式にする</h5>
<div class="paragraph">
<p><code>to_hex</code> は整数を16進形式の文字列に変換するメソッドです。<code>switch_ready</code> ハンドラの引数 <code>dpid</code> の値は64ビットの正の整数で、OpenFlowでは慣習的に <code>0xfffb</code> などと16進で表します。ターミナルやログに出力する場合には <code>to_hex</code> で16進形式に変換しておいたほうがよいでしょう。</p>
</div>
</div>
<div class="sect4">
<h5 id="_ログメッセージを出力する">ログメッセージを出力する</h5>
<div class="paragraph">
<p>ログメッセージはログファイルに記録されます。コントローラをフォアグラウンドで実行する場合、つまり <code>trema run</code> に <code>--daemonize</code> または <code>-d</code> オプションを付けない場合にはターミナルにもログメッセージが出力されます。</p>
</div>
<div class="paragraph">
<p>ログメッセージを出力するには、<code>logger</code> を使います。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="keyword">def</span> <span class="function">start</span>(_args)
  logger.info <span class="string"><span class="delimiter">'</span><span class="content">Trema started.</span><span class="delimiter">'</span></span>
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>logger</code> はTrema標準のロガーで、ログメッセージの出力はこれを通じて行います。ログメッセージの重要度に応じて、<code>critical</code> (重要度 最高)から <code>debug</code> (重要度 最低)までの次の6種類のメソッドを選べます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>critical</code>: 回復不能なエラー</p>
</li>
<li>
<p><code>error</code>: エラー</p>
</li>
<li>
<p><code>warn</code>: 警告</p>
</li>
<li>
<p><code>notice</code>: 注意が必要な情報</p>
</li>
<li>
<p><code>info</code>: 通常レベルの情報</p>
</li>
<li>
<p><code>debug</code>: デバッグ出力</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>trema run</code> のオプションでロギングレベルを指定できます。たとえば次のコードを実行するとしましょう。</p>
</div>
<div class="listingblock">
<div class="title">try_logging.rb</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span class="comment"># ロギングレベルの確認用コード</span>
<span class="keyword">class</span> <span class="class">TryLogging</span> &lt; <span class="constant">Trema</span>::<span class="constant">Controller</span>
  <span class="keyword">def</span> <span class="function">start</span>(_args)
    logger.critical <span class="string"><span class="delimiter">'</span><span class="content">CRITICAL</span><span class="delimiter">'</span></span>
    logger.error <span class="string"><span class="delimiter">'</span><span class="content">ERROR</span><span class="delimiter">'</span></span>
    logger.warn <span class="string"><span class="delimiter">'</span><span class="content">WARN</span><span class="delimiter">'</span></span>
    logger.notice <span class="string"><span class="delimiter">'</span><span class="content">NOTICE</span><span class="delimiter">'</span></span>
    logger.info <span class="string"><span class="delimiter">'</span><span class="content">INFO</span><span class="delimiter">'</span></span>
    logger.debug <span class="string"><span class="delimiter">'</span><span class="content">DEBUG</span><span class="delimiter">'</span></span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>このコードをたとえば次のようにロギングレベル <code>notice</code> で実行すると、<code>info</code> と <code>debug</code> メッセージは出力されません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./bin/trema run try_logging.rb --logging_level notice
CRITICAL
ERROR
WARN
NOTICE</pre>
</div>
</div>
<div class="paragraph">
<p>ログファイルのデフォルトパスは <code>/tmp/[コントローラのクラス名].log</code> です。たとえばHelloTremaの場合には <code>/tmp/HelloTrema.log</code> になります。ログファイルの出力先ディレクトリを変更するには、<code>trema run</code> の <code>--log_dir</code> または <code>-L</code> オプションを指定します。たとえば次のようにすると、<code>/var/log/HelloTrema.log</code> が作られます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./bin/trema run try_logging.rb --log_dir /var/log/</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_文字列を連結する">文字列を連結する</h5>
<div class="paragraph">
<p><code>logger.info</code> に渡している文字列中の <code>#{}</code> は、文字列内にRubyの式を組込みます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">logger.info <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">#{</span>dpid.to_hex<span class="inline-delimiter">}</span></span><span class="content">!</span><span class="delimiter">&quot;</span></span>
<span class="comment">#=&gt; Hello 0xabc!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>これは次のコードと同じです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">logger.info <span class="string"><span class="delimiter">'</span><span class="content">Hello </span><span class="delimiter">'</span></span> + dpid.to_hex + <span class="string"><span class="delimiter">'</span><span class="content">!</span><span class="delimiter">'</span></span>
<span class="comment">#=&gt; Hello 0xabc!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>どちらを使ってもかまいませんが、文字列を <code>+</code> でつなげすぎると最終的な出力がコードからはわかりにくくなることがあります。その場合、このように <code>#{}</code> で組み込んだほうがよいでしょう。</p>
</div>
<div class="paragraph">
<p>これで「Hello, Trema!」の説明はおしまいです。Tremaで作るコントローラは基本的にこの「Hello, Trema!」と同じ構成をしています。つまり、これをベースにいくつか必要なハンドラメソッドを追加していけば、より複雑で実践的なコントローラも作れます。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_まとめ_2">まとめ</h3>
<div class="paragraph">
<p>この章ではTremaの開発環境をセットアップし、すべてのコントローラのテンプレートとなる「Hello, Trema!」コントローラを書きました。この章で学んだことを簡単にまとめてから、より実用的なコントローラの開発に入っていくことにしましょう。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>コントローラはクラスとして定義し、<code>Trema::Controller</code> クラスを継承することでコントローラの基本機能を取り込む</p>
</li>
<li>
<p>コントローラに機能を追加するには、各種イベントに対応するハンドラをコントローラクラスに定義する</p>
</li>
<li>
<p>コントローラは <code>trema run</code> コマンドでコンパイルなしにすぐ実行できる</p>
</li>
<li>
<p>仮想ネットワーク機能を使うと、OpenFlowスイッチを持っていなくてもコントローラを実行できる</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>これでTremaの基礎知識は充分身に付きました。次の章では、OpenFlowコントローラのためのマイクロベンチマークツール、cbenchを計測するためのコントローラを書きます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_参考文献">参考文献</h3>
<div class="paragraph">
<p>Rubyプログラミングが初めてという人達のために、この章では入門に役立つサイトや本をいくつか紹介します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>「Why’s (Poignant) Guide to Ruby」(<a href="http://mislav.uniqpath.com/poignant-guide/" class="bare">http://mislav.uniqpath.com/poignant-guide/</a>)
 筆者は大学や職場でいろいろなプログラミング言語を勉強してきましたが、これほど読んでいて楽しい本に出会ったことはありません。この本はRuby会の謎の人物_why氏による風変わりなRuby入門で、プログラミング言語の解説書にもかかわらずまるで小説やマンガのようにリラックスして読めます。この章のRubyの品詞の説明は、この本を参考にしました(日本語版はhttp://www.aoky.net/articles/why_poignant_guide_to_ruby/)</p>
</li>
<li>
<p>「TryRuby」(<a href="http://tryruby.org/" class="bare">http://tryruby.org/</a>)
 同じく_why氏による、ブラウザで動くRuby環境です。Rubyを試してみたいけどインストールするのが面倒という人は、まずはここでRubyを試してみましょう。<code>help</code> と打つと15分の短いRubyチュートリアルが始まります。</p>
</li>
<li>
<p>『プログラミングRuby第2版』(Dave Thomas、Chad Fowler、Andrew Hunt著／田和勝、まつもとゆきひろ 訳／オーム社) 
Rubyの完全なリファレンスです。本気でRubyを勉強したい人は持っていて損はしません。リファレンスが必要ならこの本だけあれば十分です。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_copyright_and_license">Appendix A: Copyright and License</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This book is released under the GNU General Public License version 3.0:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.gnu.org/licenses/gpl-3.0.html" class="bare">http://www.gnu.org/licenses/gpl-3.0.html</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. MITのxpizzaコマンドのマニュアル：https://stuff.mit.edu/afs/sipb/project/lnf/other/CONTRIB/ai-info
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. カーネギーメロン大のコーク・マシンのサイト：http://www.cs.cmu.edu/~coke/
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. RFC 2324：https://www.ietf.org/rfc/rfc2324.txt
</div>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. <a href="http://rubyonrails.org/" class="bare">http://rubyonrails.org/</a>
</div>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. <a href="https://rvm.io/" class="bare">https://rvm.io/</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-09-03 07:52:47 UTC
</div>
</div>
</body>
</html>